#include "utils_crc.h"

/**
 ***********************************************************************************************************************
 * @brief 计算单个字节与之前数据的crc16值
 ***********************************************************************************************************************
 */
unsigned short utils_crc16_add(uint8_t b, uint16_t acc) {
  /* CITT CRC16 polynomial ^16 + ^12 + ^5 + 1 */
  acc ^= b;
  acc = (acc >> 8) | (acc << 8);
  acc ^= (acc & 0xff00) << 4;
  acc ^= (acc >> 8) >> 4;
  acc ^= (acc & 0xff00) >> 5;
  return acc;
}

/**
 ***********************************************************************************************************************
 * @brief 计算一端数据与之前数据的crc16值
 ***********************************************************************************************************************
 */
unsigned short utils_crc16_data(const uint8_t* data, uint16_t len,
                                uint16_t acc) {
  uint16_t i;

  for (i = 0; i < len; ++i) {
    acc = utils_crc16_add(*data, acc);
    ++data;
  }
  return acc;
}